Here is the full codebase. Please:

1. Identify bugs,
2. Suggest missing pieces,
3. Rewrite the entire codebase cleanly with comments,
4. Improve file structure,
5. Make it production-ready without changing the core logic.